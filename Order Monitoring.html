<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Order Monitoring Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
  background-color: #f5f5f7; /* subtle off-white, like Apple pages */
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  color: #1d1d1f; /* dark text but not harsh black */
  line-height: 1.6;
  margin: 0;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.card-summary {
  border-left: 4px solid #0071e3; /* Apple blue */
  background-color: #fff;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
  border-radius: 12px;
  padding: 1.5rem;
  transition: box-shadow 0.3s ease;
}

.card-summary:hover {
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}

.status-delivered {
  color: #34c759; /* Apple green */
  font-weight: 600;
}

.status-cancelled {
  color: #ff453a; /* Apple red */
  font-weight: 600;
}

.status-partial {
  color: #ff9f0a; /* Apple orange */
  font-weight: 600;
}

.upload-zone {
  border: 2px dashed #d2d2d7;
  padding: 28px;
  text-align: center;
  background-color: #f2f2f7;
  color: #636366;
  font-weight: 500;
  border-radius: 12px;
  cursor: pointer;
  transition: background-color 0.25s ease, border-color 0.25s ease;
  user-select: none;
}

.upload-zone:hover {
  background-color: #e5e5ea;
  border-color: #0071e3;
  color: #0071e3;
}

.table-wrapper {
  max-height: 500px;
  overflow-y: auto;
  border-radius: 12px;
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.04);
  background: #fff;
}

/* Modal container */
/* Modal container - wider and centered */
.modal-content {
  border-radius: 16px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  border: none;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  color: #1d1d1f;
  background-color: #fff;
  padding: 1.5rem 2rem;
  width: 100%;
  max-width: 1200px;
  margin: auto;
}

/* Ensure modal dialog respects new width */
.modal-xl {
  max-width: 1200px;
}

/* Modal body with scroll on small screens */
.modal-body {
  padding-top: 0;
  font-size: 1rem;
  color: #1d1d1f;
  overflow-x: auto;
}

/* Table styling */
#multiItemContainer table {
  width: 100%;
  table-layout: fixed;
  border-collapse: separate;
  border-spacing: 0 12px;
}

/* Column widths (optional fine-tuning) */
#multiItemContainer th:nth-child(1),
#multiItemContainer td:nth-child(1) {
  width: 22%; /* Product */
}
#multiItemContainer th:nth-child(6),
#multiItemContainer td:nth-child(6) {
  width: 25%; /* Remarks */
}

/* Inputs */
#multiItemTableBody input.form-control {
  border-radius: 10px;
  border: 1px solid #d2d2d7;
  padding: 0.5rem 0.75rem;
  font-size: 1rem;
  background-color: #fafafa;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
  width: 100%;
}

#multiItemTableBody input.form-control:focus {
  outline: none;
  border-color: #0071e3;
  box-shadow: 0 0 8px rgba(0, 113, 227, 0.4);
  background-color: #fff;
}



  :root {
    --apple-blue: #0071e3;
    --text-dark: #1d1d1f;
    --bg-light: rgba(255, 255, 255, 0.8);
    --border-light: #e3e3e6;
  }

  body {
    background-color: #f5f5f7;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    color: var(--text-dark);
    line-height: 1.6;
    margin: 0;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Sidebar styles */
  /* Sidebar container */
.sidebar {
  position: fixed;
  top: 60px; /* height of navbar */
  left: 0;
  width: 260px;
  height: calc(100vh - 60px);
  background: #f5f5f7; /* subtle Apple off-white */
  border-right: 1px solid #d1d1d6; /* softer border */
  padding: 24px 20px;
  box-shadow: 4px 0 12px rgba(0, 0, 0, 0.05); /* soft shadow for depth */
  overflow-y: auto;
  z-index: 1050;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
  color: #1d1d1f;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  border-top-right-radius: 20px; /* subtle rounding on right side */
  border-bottom-right-radius: 20px;
}

/* Sidebar title */
.sidebar-title {
  font-weight: 600;
  font-size: 1.25rem;
  letter-spacing: 0.03em;
  margin: 0 0 1rem 0;
  color: #0071e3; /* Apple blue accent */
  user-select: none;
}

/* Sidebar button */
.sidebar-btn {
  background-color: #0071e3;
  border: none;
  color: white;
  font-weight: 600;
  font-size: 1rem;
  padding: 0.75rem 1.25rem;
  border-radius: 24px;
  box-shadow: 0 4px 16px rgba(0, 113, 227, 0.3);
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
  cursor: pointer;
  user-select: none;
}

.sidebar-btn:hover,
.sidebar-btn:focus {
  background-color: #005bb5;
  box-shadow: 0 6px 20px rgba(0, 91, 181, 0.5);
  outline: none;
}

  </style>
</head>
<body>
  <!-- NAVIGATION -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">üì¶ Order Monitor</a>
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link active" href="#">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="Chart project.html">Charts</a></li>
        <li class="nav-item"><a class="nav-link" href="#">Upload</a></li>
      </ul>
      <span id="userEmailDisplay" class="navbar-text text-white ms-auto"></span>
    </div>
  </nav>

  <!-- Sidebar -->
<div id="sidebar" class="sidebar">
  <h5 class="sidebar-title">Functions</h5>
  <button id="btnShowUpdate" class="btn btn-primary sidebar-btn w-100 mb-3">
    UPDATE ORDER DETAILS
  </button>
</div>

  <!-- MAIN CONTENT -->
  <div id="mainContent" style="margin-left: 270px; padding: 20px;">
    <!-- DASHBOARD SUMMARY -->
    <div class="container-fluid p-0 mb-4">
      <div class="row text-center gx-3">
        <div class="col-md-3 mb-3">
          <div class="card card-summary">
            <div class="card-body">
              <h5>Total Orders</h5>
              <h3 id="totalOrders">--</h3>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="card card-summary">
            <div class="card-body">
              <h5>Delivered</h5>
              <h3 class="text-success" id="deliveredOrders">--</h3>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="card card-summary">
            <div class="card-body">
              <h5>Cancelled</h5>
              <h3 class="text-danger" id="cancelledOrders">--</h3>
            </div>
          </div>
        </div>
        <div class="col-md-3 mb-3">
          <div class="card card-summary">
            <div class="card-body">
              <h5>In Progress</h5>
              <h3 class="text-warning" id="partialOrders">--</h3>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- FILTERS + UPLOAD -->
    <div class="container-fluid p-0 mb-4">
      <div class="row gx-3">
        <div class="col-md-3">
          <input type="text" class="form-control" placeholder="Search Customer/Product..." id="searchInput">
        </div>
        <div class="col-md-3">
          <select class="form-select" id="statusFilter">
            <option value="">All Status</option>
            <option value="Delivered">Delivered</option>
            <option value="Cancelled">Cancelled</option>
            <option value="Partial">Partial</option>
          </select>
        </div>
        <div class="col-md-6">
          <label class="upload-zone" for="excelFile">
            üìÅ Click or drag Excel file to upload
            <input type="file" id="excelFile" accept=".xlsx, .xls" hidden>
          </label>
        </div>
      </div>
    </div>

    <!-- ORDERS TABLE -->
    <div class="container-fluid p-0 mb-5">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">üìã Order List</h5>
        </div>
        <div class="card-body p-0">
          <div style="max-height: 500px; overflow-y: auto;">
            <table class="table table-hover table-bordered align-middle mb-0">
              <thead class="table-light sticky-top">
                <tr>
                  <th style="min-width: 120px;">Order ID</th>
                  <th style="min-width: 140px;">Order Date</th>
                  <th style="min-width: 150px;">Customer</th>
                  <th style="min-width: 200px;">Product</th>
                  <th>Qty</th>
                  <th>Delivered</th>
                  <th>Cancelled</th>
                  <th>Balance</th>
                  <th>Unit Price</th>
                  <th>Amount</th>
                  <th>Status</th>
                  <th>Remarks</th>
                </tr>
              </thead>
              <tbody id="orderTableBody">
                <!-- JavaScript will populate rows here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- CHART SECTION -->
    <div class="container-fluid p-0 mb-5">
      <h4 class="mb-3">üìä Charts</h4>
      <canvas id="chartCanvas" height="100"></canvas>
    </div>
  </div>

  <!-- Edit Multiple Order Items Modal -->
<div class="modal fade" id="updateOrderModal" tabindex="-1" aria-labelledby="updateOrderModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content rounded-4 shadow-lg border-0">
      <div class="modal-header border-0 pb-0">
        <h5 class="modal-title" id="updateOrderModalLabel">
          Update Order <span id="modalOrderNumber" class="text-primary"></span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body pt-0">
        <div id="multiItemContainer">
          <table class="table table-bordered table-hover">
            <thead class="table-light">
              <tr>
                <th>Product</th>
                <th>Qty Ordered</th>
                <th>Qty Delivered</th>
                <th>Qty Cancelled</th>
                <th>Unit Price</th>
                <th>Remarks</th>
              </tr>
            </thead>
            <tbody id="multiItemTableBody">
              <!-- JavaScript will inject order item rows here -->
            </tbody>
          </table>
        </div>
      </div>

      <div class="modal-footer border-0 pt-0">
        <button type="button" class="btn btn-secondary rounded-pill px-4" data-bs-dismiss="modal">Cancel</button>
        <button type="button" id="saveUpdateBtn" class="btn btn-primary rounded-pill px-4">Save</button>
      </div>
    </div>
  </div>
</div>

</body>



 
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyD9LCzMuEGIiRQrOVCgH6d-jxxJLZ0QBCk",
    authDomain: "order-monitoring-purchasing.firebaseapp.com",
    projectId: "order-monitoring-purchasing",
    storageBucket: "order-monitoring-purchasing.appspot.com",
    messagingSenderId: "209378598320",
    appId: "1:209378598320:web:0c143d69bc329a994d8a75",
    measurementId: "G-PPNWT4ECV0"
  };

  firebase.initializeApp(firebaseConfig);
  firebase.analytics();

  const auth = firebase.auth();
  const firestore = firebase.firestore();

  let fullData = [];
  let currentEditingOrderId = '';
  let currentUserId = null; // Use UID for Firestore path

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUserId = user.uid;

      // Display user email in navbar (make sure you have element with this ID)
      const emailElem = document.getElementById('userEmailDisplay');
      if(emailElem) emailElem.textContent = user.email || 'User';

      // Load orders from Firestore collection
      loadOrdersFromFirestore(currentUserId);
    } else {
      // If no user, redirect to login
      window.location.href = "login.html";
    }
  });

  document.getElementById('excelFile').addEventListener('change', handleFile, false);
  document.getElementById('searchInput').addEventListener('input', filterTable);
  document.getElementById('statusFilter').addEventListener('change', filterTable);

  async function loadOrdersFromFirestore(userId) {
    try {
      const ordersSnapshot = await firestore.collection('orders').doc(userId).collection('userOrders').get();
      fullData = [];ordersSnapshot.forEach(doc => {
  const data = doc.data();
  data["docId"] = doc.id; // ‚úÖ Attach Firestore doc ID
  fullData.push(data);
});


      populateTable(fullData);
      updateSummary(fullData);
    } catch (error) {
      console.error("Error loading user orders:", error);
      fullData = [];
      populateTable(fullData);
      updateSummary(fullData);
    }
  }

  function handleFile(e) {
    const file = e.target.files[0];
    if (!file || !currentUserId) return;

    const reader = new FileReader();
    reader.onload = async function (e) {
      const data = new Uint8Array(e.target.result);
      const workbook = XLSX.read(data, { type: 'array' });
      const worksheet = workbook.Sheets[workbook.SheetNames[0]];
      fullData = XLSX.utils.sheet_to_json(worksheet);

      const dateFields = ["Order Date", "Need By Date", "Approved Date"];
      fullData = fullData.map(row => {
        dateFields.forEach(field => {
          if (row[field]) row[field] = formatDate(row[field]);
        });
        return row;
      });

      populateTable(fullData);
      updateSummary(fullData);

      // Save to Firestore under user collection
      try {
        await saveOrdersToFirestore(currentUserId, fullData);
        console.log('Data saved under current user in Firestore');
      } catch (error) {
        console.error('Save error:', error);
      }
    };

    reader.readAsArrayBuffer(file);
  }



const btnShowUpdate = document.getElementById('btnShowUpdate');
const updateOrderModal = new bootstrap.Modal(document.getElementById('updateOrderModal'));
const modalOrderNumber = document.getElementById('modalOrderNumber');
const saveUpdateBtn = document.getElementById('saveUpdateBtn');

// Form fields inside modal
const updateProduct = document.getElementById('updateProduct');
const updateQtyOrdered = document.getElementById('updateQtyOrdered');
const updateQtyDelivered = document.getElementById('updateQtyDelivered');
const updateQtyCancelled = document.getElementById('updateQtyCancelled');
const updateUnitPrice = document.getElementById('updateUnitPrice');
const updateRemarks = document.getElementById('updateRemarks');

let currentOrderId = null;
let currentItem = null;

btnShowUpdate.addEventListener('click', () => {
  // Ask for Order ID with prompt
  const orderId = prompt("Enter Order ID to update:");
  if (!orderId) {
    alert("No Order ID entered.");
    return;
  }

  // Search order by ID
  const matchingItems = fullData.filter(item => item["Number"] && item["Number"].toString() === orderId);

  if (matchingItems.length === 0) {
    alert("No order found with this ID.");
    return;
  }

  currentOrderId = orderId;
  currentItem = [...matchingItems]; // store full array
modalOrderNumber.textContent = orderId;

// Clear any previous rows in modal
const tableBody = document.getElementById("multiItemTableBody");
tableBody.innerHTML = "";

// Inject a row per item
matchingItems.forEach((item, index) => {
  const row = document.createElement("tr");
  row.innerHTML = `
    <td><input type="text" class="form-control" value="${item["Description"] || ''}" data-field="Description" data-index="${index}" /></td>
    <td><input type="number" class="form-control" value="${item["Quantity Ordered"] || 0}" data-field="Quantity Ordered" data-index="${index}" /></td>
    <td><input type="number" class="form-control" value="${item["Quantity Delivered"] || 0}" data-field="Quantity Delivered" data-index="${index}" /></td>
    <td><input type="number" class="form-control" value="${item["Quantity Cancelled"] || 0}" data-field="Quantity Cancelled" data-index="${index}" /></td>
    <td><input type="number" class="form-control" value="${item["Unit Price"] || 0}" step="0.01" data-field="Unit Price" data-index="${index}" /></td>
    <td><input type="text" class="form-control" value="${item["REMARKS"] || ''}" data-field="REMARKS" data-index="${index}" /></td>
  `;
  tableBody.appendChild(row);
});


  updateOrderModal.show();
});

// You can now remove the old btnSearchOrder listener since the search happens on btnShowUpdate

saveUpdateBtn.addEventListener('click', () => {
  if (!currentUserId) {
    alert('User not authenticated');
    return;
  }

  if (!currentOrderId || !currentItem || !Array.isArray(currentItem)) {
    alert('No order loaded');
    return;
  }

  // Loop through each row to gather updated values
  const inputs = document.querySelectorAll('#multiItemTableBody input');
  inputs.forEach(input => {
    const index = parseInt(input.dataset.index);
    const field = input.dataset.field;
    let value = input.value;

    if (["Quantity Ordered", "Quantity Delivered", "Quantity Cancelled", "Unit Price"].includes(field)) {
      value = Number(value) || 0;
    }

    currentItem[index][field] = value;
  });

  // Recalculate balance and update Firestore
  saveUpdateBtn.disabled = true;
  saveUpdateBtn.textContent = "Saving...";

  const batch = firestore.batch();

  currentItem.forEach(item => {
    item["BALANCE"] = item["Quantity Ordered"] - item["Quantity Delivered"] - item["Quantity Cancelled"];
    const docRef = firestore.collection("orders")
      .doc(currentUserId)
      .collection("userOrders")
      .doc(item["docId"]);

    console.log("Updating document:", item["docId"]); // <-- Log docId before update

    batch.update(docRef, item);
  });

  batch.commit()
    .then(() => {
      alert("Order items updated successfully.");

      // Update fullData in memory
      currentItem.forEach(updated => {
        const index = fullData.findIndex(item => item["ID"] === updated["ID"] || item["docId"] === updated["docId"]);
        if (index !== -1) {
          fullData[index] = { ...updated };
        }
      });

      populateTable(fullData);
      updateSummary(fullData);
      updateOrderModal.hide();
    })
    .catch(error => {
      console.error("Update failed:", error);
      alert("Failed to update. See console for details.");
    })
    .finally(() => {
      saveUpdateBtn.disabled = false;
      saveUpdateBtn.textContent = "Save";
    });
});




















async function saveOrdersToFirestore(userId, ordersArray) {
  const batch = firestore.batch();
  const ordersCollection = firestore.collection('orders').doc(userId).collection('userOrders');

  // Optional: delete existing docs first (caution: batch limit is 500)
  const existingOrders = await ordersCollection.get();
  existingOrders.forEach(doc => batch.delete(doc.ref));

  // Save each order with a unique ID (even if Number is duplicated)
  ordersArray.forEach((order, index) => {
  const uniqueId = `${order.Number || 'order'}-${index}`;
  order["docId"] = uniqueId; // ‚úÖ Save docId inside order data
  const docRef = ordersCollection.doc(uniqueId);
  batch.set(docRef, order);
});


  await batch.commit();
}





  function determineStatus(row) {
    const delivered = Number(row["Quantity Delivered"] || 0);
    const ordered = Number(row["Quantity Ordered"] || 0);
    const cancelled = Number(row["Quantity Cancelled"] || 0);

    if (cancelled > 0) return 'Cancelled';
    if (delivered === ordered && ordered > 0) return 'Delivered';
    if (delivered > 0 && delivered < ordered) return 'Partial';
    return 'Pending';
  }

 function populateTable(data) {
  const tbody = document.getElementById('orderTableBody');
  tbody.innerHTML = '';

  data.forEach(row => {
    const status = determineStatus(row);
    const qty = Number(row["Quantity Ordered"] || 0);
    const unitPrice = parseFloat(row["Unit Price"] || 0);
    const amount = (qty * unitPrice).toFixed(2);

    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${row["Number"] || ''}</td>
      <td>${row["Order Date"] || ''}</td>
      <td>${row["Supplier"] || ''}</td>
      <td>${row["Description"] || ''}</td>
      <td>${qty}</td>
      <td>${row["Quantity Delivered"] || 0}</td>
      <td>${row["Quantity Cancelled"] || 0}</td>
      <td>${row["BALANCE"] || 0}</td>
      <td>${unitPrice.toFixed(2)}</td>
      <td>${amount}</td>
      <td class="${getStatusClass(status)}">${status}</td>
      <td>${row["REMARKS"] || ''}</td>
  
    `;
    tbody.appendChild(tr);
  });
}


  function getStatusClass(status) {
    const s = status.toLowerCase();
    return s === 'delivered' ? 'status-delivered' :
           s === 'cancelled' ? 'status-cancelled' :
           s === 'partial' ? 'status-partial' : '';
  }

  function formatDate(value) {
    if (!value) return '';
    let d;

    if (typeof value === 'string') {
      const match = value.match(/(\d{1,2})\/(\d{1,2})\/(\d{4})/);
      d = match ? new Date(match[3], match[1] - 1, match[2]) : new Date(value);
    } else if (!isNaN(value)) {
      d = new Date(Date.UTC(1899, 11, 30) + value * 86400000);
    }

    return d instanceof Date && !isNaN(d.getTime()) ? 
      d.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : '';
  }

  function updateSummary(data) {
    let delivered = 0, cancelled = 0, inProgress = 0;

    data.forEach(row => {
      const ordered = Number(row["Quantity Ordered"] || 0);
      const deliveredQty = Number(row["Quantity Delivered"] || 0);
      const cancelledQty = Number(row["Quantity Cancelled"] || 0);

      if (cancelledQty > 0) cancelled++;
      else if (deliveredQty === ordered && ordered > 0) delivered++;
      else if (deliveredQty !== ordered && cancelledQty === 0) inProgress++;
    });

    document.getElementById('totalOrders').textContent = data.length;
    document.getElementById('deliveredOrders').textContent = delivered;
    document.getElementById('cancelledOrders').textContent = cancelled;
    document.getElementById('partialOrders').textContent = inProgress;
  }

  function filterTable() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    const statusFilter = document.getElementById('statusFilter').value.toLowerCase();

    const filtered = fullData.filter(row => {
      const customer = (row["Customer"] || row["Supplier"] || '').toLowerCase();
      const product = (row["Product"] || row["Description"] || '').toLowerCase();
      const status = determineStatus(row).toLowerCase();

      return (customer.includes(search) || product.includes(search)) &&
             (!statusFilter || status === statusFilter);
    });

    populateTable(filtered);
    updateSummary(filtered);
  }

  

  function submitRemarks() {
    const newText = document.getElementById('newRemarks').value.trim();
    const orderId = currentEditingOrderId;

    if (!orderId || !currentUserId) return;

    firestore.collection('orders').doc(currentUserId).collection('userOrders').doc(orderId)
      .update({ REMARKS: newText })
      .then(() => {
        // Update local data and UI
        const row = fullData.find(r => r["Number"] == orderId);
        if (row) row["REMARKS"] = newText;
        populateTable(fullData);
        console.log('Remarks updated in Firestore');
      })
      .catch(err => console.error('Error updating remarks:', err));

    const modalEl = document.getElementById('editModal');
    const modal = bootstrap.Modal.getInstance(modalEl);
    modal.hide();
  }
</script>





</body>
</html>
